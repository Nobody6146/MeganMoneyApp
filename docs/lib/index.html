<html lang="en">
    <head>
        <title>Hydrate Demo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <script src="hydrate.js"></script>
        <style>
            .fontStyle {
                color: red;
            }
        </style>
    </head>
    <body>
        <main h-model="state" h-delete="* {{event.state == null}}" h-function="delete yellFunction {{'how could you delete me!'}}" h-event="unbind">
            <script h-script="StyleScript">
                (event) => {
                    console.log("calculating style");
                    return `color: ${event.prop}`;
                }
            </script>
            <script h-script="CanChangeColorScript">
                (event) => {
                    return event.propName === "color" && event.prop !== "black";
                }
            </script>
            
            <h1 h-model="state" h-attribute="color style StyleScript" h-static h-condition="CanChangeColorScript">Hydrate Demo</h1>
            
            <div h-model="state" h-class="addStyle fontStyle">
                <h2 h-model="state" h-attribute="greeting name" h-property="greeting innerHTML"></h2>
                <p>
                    <span h-model="state.data.person.contact" h-property="firstName innerHTML"></span>
                    <span h-model="state.data.person.contact" h-property="lastName innerHTML"></span>
                    <div h-model="state" h-toggle="secret hidden">You this is a hidden div!</div>
                </p>
                <p h-model="state" h-property="message innerHTML"></p>
            </div>
    
            <button h-model="state" h-handler="click onclick">
                Click Me!
            </button>
    
            <input type="text" h-model="state" h-attribute="greeting value" h-input="greeting value" h-callback="greeting validateInput">
            
            <span h-model="state" h-dispatch="relay custom {{'state.greeting'}}"></span>
    
            <script h-script="CreateStyleScript">
                (event) => {
                    return `color: ${event.prop}; width: 10px;`
                }
            </script>
            <span h-model="state" h-attribute="color style CreateStyleScript"></span>
            <span h-model="state" h-attribute="class class {{`${event.propName}-color`}}"></span>
    
            <div h-router>
                <section h-model="page" h-route="/products/:id url ./products/index.html"></section>
                <section h-model="page" h-route=".* template NotFoundTemplate"></section>
            </div>

            <template h-template="FormTemplate">
                <script h-model="_" h-initialize>
                    (event) => {
                        console.log("form initialized!");
                        console.log(event);
                        
                    }
                </script>
                <div h-model="_">
                    <label>Please select a number</label>
                    <input h-model="_" h-property="value value">
                </div>
            </template>

            <div h-model="state" h-component="form FormTemplate">
            </div>
    
            <br/>
            <label>Whole inventory</label>
            <div h-model="state" h-component="inventory FormTemplate">
            </div>

            <br/>
            <label>Per item</label>
            <label>total: 
                <span h-model="state.inventory" h-property="length innerHTML"> </span>
            </label>
            <div h-model="state.inventory" h-component="* FormTemplate append enumerable">
            </div>
        </main>
        
        <script>
            let hydrate = new HydrateApp();
            hydrate.subscribe("state", (event) => console.log(event));
            hydrate.subscribe("state.data.person.contact", (event) => {console.log("wow!"); console.log(event)});
            let state = {greeting: "Hello world"};
            let model = hydrate.bind("state", state);
            model.data = {
                person: {
                    contact: {
                        firstName: "Bob",
                        lastName: "Builder"
                    }
                }
            };
            model.secret = true;
            model.click = (clickEvent, hydrateEvent) => {
                console.log("you clicked me!");
                console.log(hydrateEvent);
            }
            model.validateInput = (hydrateEvent, arg) => {
                console.log(`${hydrateEvent.propName} has been updated to: ${hydrateEvent.prop}`);
            }
            model.inventory = [{name: "Apples", value: 1}, {name: "Oranges", value: 2}];

            function yellFunction(hydrateEvent, arg) {
                console.log(arg);
            }
        </script>
    </body>
</html>